# å¡ç‰‡æ¨¡æ¿é…ç½®è¯´æ˜

## æ¦‚è¿°

ZenOps çš„é’‰é’‰é›†æˆæ”¯æŒä¸¤ç§æ¶ˆæ¯æ¨¡å¼:

1. **æµå¼å¡ç‰‡æ¨¡å¼**: éœ€è¦é…ç½®å¡ç‰‡æ¨¡æ¿ID,æä¾›æ›´å¥½çš„äº¤äº’ä½“éªŒ
2. **ä¼ ç»Ÿæ–‡æœ¬æ¨¡å¼**: æ— éœ€é…ç½®å¡ç‰‡æ¨¡æ¿,ä½¿ç”¨Markdownæ–‡æœ¬æ¶ˆæ¯(é»˜è®¤æ¨¡å¼)

ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹é…ç½®å¹¶é€‰æ‹©åˆé€‚çš„æ¨¡å¼,å¦‚æœå¡ç‰‡åˆ›å»ºå¤±è´¥ä¼šè‡ªåŠ¨é™çº§ä¸ºæ–‡æœ¬æ¨¡å¼ã€‚

## ä¸é…ç½®å¡ç‰‡æ¨¡æ¿(æ¨èæ–°æ‰‹)

### é…ç½®ç¤ºä¾‹

```yaml
dingtalk:
  enabled: true
  mode: "stream"
  app_key: "ä½ çš„AppKey"
  app_secret: "ä½ çš„AppSecret"
  agent_id: "ä½ çš„AgentID"

  # ä¸é…ç½®å¡ç‰‡æ¨¡æ¿
  card_template_id: ""
  enable_stream_card: false
```

### ä¼˜ç‚¹

- âœ… é…ç½®ç®€å•,æ— éœ€é¢å¤–è®¾ç½®
- âœ… ç«‹å³å¯ç”¨,æ— éœ€åˆ›å»ºå¡ç‰‡æ¨¡æ¿
- âœ… ç¨³å®šå¯é ,ä¸ä¾èµ–å¡ç‰‡API

### ç¼ºç‚¹

- âš ï¸ æ— æ³•å®æ—¶æµå¼æ›´æ–°
- âš ï¸ æ¶ˆæ¯æ ·å¼è¾ƒç®€å•

### æ¶ˆæ¯ç¤ºä¾‹

```
ğŸ” æ­£åœ¨æŸ¥è¯¢é˜¿é‡Œäº‘ ECS,è¯·ç¨å€™...

âœ… é˜¿é‡Œäº‘ ECS æŸ¥è¯¢å®Œæˆ

[æŸ¥è¯¢ç»“æœ]
```

## é…ç½®å¡ç‰‡æ¨¡æ¿(æ¨èè¿›é˜¶ç”¨æˆ·)

### æ­¥éª¤ 1: åˆ›å»ºå¡ç‰‡æ¨¡æ¿

1. ç™»å½• [é’‰é’‰å¼€æ”¾å¹³å°](https://open.dingtalk.com/)
2. è¿›å…¥ä½ çš„åº”ç”¨
3. é€‰æ‹© "äº’åŠ¨å¡ç‰‡" -> "åˆ›å»ºå¡ç‰‡æ¨¡æ¿"
4. é€‰æ‹© "AIæµå¼å¡ç‰‡" ç±»å‹

### æ­¥éª¤ 2: é…ç½®å¡ç‰‡å†…å®¹

åˆ›å»ºä¸€ä¸ªç®€å•çš„å¡ç‰‡æ¨¡æ¿:

```json
{
  "config": {
    "autoLayout": true,
    "enableForward": true
  },
  "header": {
    "title": {
      "type": "text",
      "text": "ZenOps æŸ¥è¯¢åŠ©æ‰‹"
    },
    "logo": "@lALPDfJ6V_FPDmvNAfTNAfQ"
  },
  "contents": [
    {
      "type": "markdown",
      "text": "{{content}}",
      "id": "markdown_content"
    }
  ]
}
```

**å…³é”®ç‚¹**:
- å¿…é¡»åŒ…å«ä¸€ä¸ªåä¸º `content` çš„å˜é‡(é€šè¿‡ `{{content}}` å¼•ç”¨)
- å¡ç‰‡ç±»å‹é€‰æ‹©æ”¯æŒæµå¼æ›´æ–°

### æ­¥éª¤ 3: è·å–æ¨¡æ¿ID

åˆ›å»ºå®Œæˆå,å¤åˆ¶æ¨¡æ¿ID(æ ¼å¼ç±»ä¼¼: `xxx.schema`)

### æ­¥éª¤ 4: æ›´æ–°é…ç½®

```yaml
dingtalk:
  enabled: true
  mode: "stream"
  app_key: "ä½ çš„AppKey"
  app_secret: "ä½ çš„AppSecret"
  agent_id: "ä½ çš„AgentID"

  # é…ç½®å¡ç‰‡æ¨¡æ¿ID
  card_template_id: "ä½ çš„æ¨¡æ¿ID.schema"
  enable_stream_card: true
```

### æ­¥éª¤ 5: é‡å¯æœåŠ¡

```bash
./bin/zenops
```

### ä¼˜ç‚¹

- âœ… å®æ—¶æµå¼æ›´æ–°,ä½“éªŒæ›´å¥½
- âœ… æ”¯æŒæ›´ä¸°å¯Œçš„æ ·å¼
- âœ… æ”¯æŒè¿›åº¦å±•ç¤º

### ç¼ºç‚¹

- âš ï¸ éœ€è¦é¢å¤–é…ç½®
- âš ï¸ ä¾èµ–é’‰é’‰å¡ç‰‡APIç¨³å®šæ€§

### æ¶ˆæ¯ç¤ºä¾‹

```
[å®æ—¶æ›´æ–°çš„å¡ç‰‡]
æŸ¥è¯¢é˜¿é‡Œäº‘ ECS

â³ æ­£åœ¨æŸ¥è¯¢é˜¿é‡Œäº‘ ECS...
â†“
âœ… é˜¿é‡Œäº‘ ECS æŸ¥è¯¢å®Œæˆ

[æŸ¥è¯¢ç»“æœé€å­—æµå¼æ˜¾ç¤º]
```

## è‡ªåŠ¨é™çº§æœºåˆ¶

ç³»ç»Ÿå…·æœ‰å®Œå–„çš„é™çº§æœºåˆ¶:

1. **å¡ç‰‡æ¨¡æ¿IDæœªé…ç½®** -> ç›´æ¥ä½¿ç”¨æ–‡æœ¬æ¨¡å¼
2. **å¡ç‰‡åˆ›å»ºå¤±è´¥** -> è‡ªåŠ¨é™çº§ä¸ºæ–‡æœ¬æ¨¡å¼
3. **å¡ç‰‡æ›´æ–°å¤±è´¥** -> è®°å½•è­¦å‘Š,ç»§ç»­æ‰§è¡Œ

æ— è®ºå“ªç§æƒ…å†µ,éƒ½ä¸ä¼šå½±å“åŠŸèƒ½çš„æ­£å¸¸ä½¿ç”¨ã€‚

## å¸¸è§é—®é¢˜

### Q: ä¸é…ç½®å¡ç‰‡æ¨¡æ¿èƒ½ç”¨å—?
**A**: å¯ä»¥!é»˜è®¤ä½¿ç”¨æ–‡æœ¬æ¨¡å¼,åŠŸèƒ½å®Œå…¨æ­£å¸¸ã€‚

### Q: å¦‚ä½•çŸ¥é“å½“å‰ä½¿ç”¨çš„æ˜¯å“ªç§æ¨¡å¼?
**A**: æŸ¥çœ‹æ—¥å¿—:
- `Card template not configured, using text reply` - æ–‡æœ¬æ¨¡å¼
- `Creating stream card` - å¡ç‰‡æ¨¡å¼

### Q: å¡ç‰‡åˆ›å»ºå¤±è´¥æ€ä¹ˆåŠ?
**A**: ä¸ç”¨æ‹…å¿ƒ,ç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§ä¸ºæ–‡æœ¬æ¨¡å¼,å¹¶åœ¨æ—¥å¿—ä¸­æç¤º:
```
Failed to create card, fallback to text reply
```

### Q: æ–‡æœ¬æ¨¡å¼å’Œå¡ç‰‡æ¨¡å¼å¯ä»¥åŠ¨æ€åˆ‡æ¢å—?
**A**: å¯ä»¥!ä¿®æ”¹é…ç½®åé‡å¯æœåŠ¡å³å¯ã€‚

### Q: æ¨èä½¿ç”¨å“ªç§æ¨¡å¼?
**A**:
- **æ–°æ‰‹**: æ¨èæ–‡æœ¬æ¨¡å¼,ç®€å•å¯é 
- **è¿›é˜¶**: æ¨èå¡ç‰‡æ¨¡å¼,ä½“éªŒæ›´å¥½

## æ—¥å¿—è¯´æ˜

### æ–‡æœ¬æ¨¡å¼æ—¥å¿—

```
Card template not configured, using text reply
Sent text reply successfully
```

### å¡ç‰‡æ¨¡å¼æ—¥å¿—

```
Creating stream card
Card created successfully
Streaming update: 0/1000 chars
Streaming update: finalized
```

### é™çº§æ—¥å¿—

```
Failed to create card, fallback to text reply
Sent text reply successfully
```

## é…ç½®å»ºè®®

### å¼€å‘æµ‹è¯•é˜¶æ®µ

```yaml
dingtalk:
  card_template_id: ""        # ä¸é…ç½®,ä½¿ç”¨æ–‡æœ¬æ¨¡å¼
  enable_stream_card: false
```

**ç†ç”±**: é…ç½®ç®€å•,å¿«é€ŸéªŒè¯åŠŸèƒ½

### ç”Ÿäº§ç¯å¢ƒ

```yaml
dingtalk:
  card_template_id: "xxx.schema"  # é…ç½®å¡ç‰‡æ¨¡æ¿
  enable_stream_card: true
```

**ç†ç”±**: æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

## æ€»ç»“

- ğŸ“Œ **å¡ç‰‡æ¨¡æ¿ä¸æ˜¯å¿…éœ€çš„**,ä¸é…ç½®ä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨
- ğŸ“Œ ç³»ç»Ÿä¼š**è‡ªåŠ¨æ£€æµ‹é…ç½®**å¹¶é€‰æ‹©åˆé€‚çš„æ¨¡å¼
- ğŸ“Œ **è‡ªåŠ¨é™çº§æœºåˆ¶**ä¿è¯ç³»ç»Ÿç¨³å®šæ€§
- ğŸ“Œ å¯ä»¥æ ¹æ®éœ€æ±‚**éšæ—¶åˆ‡æ¢**æ¨¡å¼

å»ºè®®å…ˆä½¿ç”¨æ–‡æœ¬æ¨¡å¼éªŒè¯åŠŸèƒ½,ç¡®è®¤æ— è¯¯åå†è€ƒè™‘é…ç½®å¡ç‰‡æ¨¡æ¿ã€‚
